<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Add Â· GoDeep by DeepSight AI Labs</title>
    <link rel="icon" href="favicon.ico" type="image/x-icon" />
    <link href="css/style.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

    <!-- TODO: Move PHP code to app.py -->
    <!-- <script>
    window.onload = loadInit;

    function loadInit() 
    {
        if (!checkLicenseValidity())
        {
            return;
        }
        
        $.ajax({
            url: 'load.php',
            type: 'POST',
            data: {
                reqMethod: 'getBackground'
            },
            dataType: "json",
            success: function(response) {
                console.log("Response");
                console.log(response);
                var bg_img = "url('img/"+response['image']+"')";                
                document.getElementById('main').style.backgroundImage = bg_img;
                $('#select').val(response['image']);
            },
            error: function() {
                // alert("Failed establishing communication with the server");
                window.location="home";
            }
        });
               
        $.ajax({
            url: 'load.php',
            type: 'POST',
            data: {
                reqMethod: 'getAllCameras'
            },
            dataType: "json",
            success: function(response) {
                console.log("Response");
                console.log(response);
                //var result= $.parseJSON(response);                        
                recordsTableData(response);
                //$(document).ajaxStop($.unblockUI);
            },
            error: function() {
                // alert("Failed establishing communication with the server");
                window.location="home";
            }
        });     
    }

    function checkLicenseValidity()
    {
        var ret = false;
        console.log("Checking license validity");
        $.ajax({
            url: 'load.php',
            type: 'POST',
            data: { reqMethod: 'getLicenseValidity' },
            dataType: "json",
            async: false,
            success: function(response) 
            {
                console.log(response);
                ret = response["status"];
                if (!ret)
                {
                    alert(response["reason"]);
                    window.location="home";
                }  
            },
            error: function()
            {
                // alert("Failed establishing communication with the server");
                window.location="home";
            }
        });

        return ret;
    }
    
    function recordsTableData(result) {
        //    console.log(result)
        let tbody = "";
        $.each(result, function(key, val) {

            //console.log(key);
            //console.log(val);

            var objectArray = val['object_detect'];

            //console.log(objectArray);
            //console.log(objectArray['fire']);

            tbody += "<tr>" +                               
                "<td align=\"center\">" + val['camera_name'] + "</td>" +
                "<td align=\"center\">" + val['rtsp_url'] + "</td>"+
                "<td align=\"center\">" + val['email_list'] + "</td>" +
                "<td align=\"center\">" + val['sms_list'] + "</td>" +
                "<td align=\"center\">" + val['call_list'] + "</td>" +
                "<td align=\"center\">" + objectArray['hoody'] + "</td>" +
                "<td align=\"center\">" + objectArray['burkha'] + "</td>" +
                "<td align=\"center\">" + objectArray['helmet'] + "</td>" +
                "<td align=\"center\">" + objectArray['fire'] + "</td>" +
                "<td align=\"center\">" + objectArray['intrusion'] + "</td>" +
                "<td align=\"center\">" + val['intrusion_start_time'] + "</td>" +
                "<td align=\"center\">" + val['intrusion_end_time'] + "</td>" +
                "<td align=\"center\">" + val['floor'] + "</td>" +
                "<td align=\"center\">" + val['sound_alarm'] + "</td>" +
                "<td align=\"center\">" + '<button class="btn_edit" onclick="onEditClicked(' + key + ')">Edit</button>' + "</td>" +
                "<td align=\"center\">" + '<button onclick="deleteCamera(' + key + ')" class="btn_delet">Delete</button>' + "</td>" +
                "</tr>";
        });
        $('#tBodyData').empty();
        $('#tBodyData').append(tbody);
    }

    function onEditClicked(id) {
        localStorage.setItem("camera_id", id);
        $("#header").load("edit");
    };

    function deleteCamera(id) {
        console.log(id);
        //$.blockUI();
        $.ajax({
            url: 'load.php',
            type: 'POST',
            data: {
                reqMethod: 'deleteCamera',
                camera_id: id
            },
            dataType: "json",
            success: function(response) {
                console.log("Response");
                console.log(response);
                //$(document).ajaxStop($.unblockUI);
                //var result= $.parseJSON(response); 
                loadInit();
            },
            error: function() {
                // alert("Failed establishing communication with the server");
                window.location="home";
            }
        });
    }

    function changeBackgroundImage() {        
        var img = document.getElementById('select').value;        
        var bg_img = "url('img/"+img+"')";
        document.getElementById('main').style.backgroundImage = bg_img;
        saveBackgroundImage(img);
    }
    
    function saveBackgroundImage(img){
        var data = {};
        data['image'] = img;
        console.log(data);
        var jsondata = JSON.stringify(data);
        console.log(jsondata);
        $.ajax(
        {
                url: 'load.php',
                type: 'POST',
                data: { reqMethod: 'sendBackground',data:jsondata},
                dataType: "json",
                success: function (response) {
                    console.log("Response<br/>");
                    console.log(response);   
                    //$(document).ajaxStop($.unblockUI);
                     //alert("submit");
                    //console.log(response['status']);
                },
                error: function () {
                    // alert("Failed establishing communication with the server");
                    window.location="home";
                }
        });
    }
    
    function readURL(event) {
        var getImagePath = URL.createObjectURL(event.target.files[0]);
        $('#main').css('background-image', 'url(' + getImagePath + ')');
    }

    $(document).ready(function() 
    {
        $("#edit").click(function() 
        {
            $("#header").load("edit");
        });
    });

    $(document).ready(function() 
    {
        $("#register").click(function() 
        {
            $("#header").load("registration");
        });         
    });
</script> -->

</head>

<body id="main">
    <div>
        <div>
            <div class="col-md-12 imgs subcthre div_paddinglr">
                <div id="header" class="col-md-11 div_main" "/*height: 590px auto;overflow-y: scroll;*/">
                    <div class="col-md-12 table-responsive" style="padding-left: 0px;">
                        <img src="static/img/Deepsight_AI_Labs.png" alt="DeepSight AI Labs" class="img_style img-responsive">

                        <select onchange="changeBackgroundImage()" id="select" class="btn_user_list selectpicker" style="width: 100px;">
                            <option value="">Select</option>
                            <option value="Bank.jpeg" id="img" style="padding: 5px;width: 100px;">Bank</option>
                            <option value="Hospital.jpeg" id="img" style="padding: 5px;width: 100px;">Hospital</option>
                            <option value="Insurance.jpeg" id="img2" style="padding: 5px;width: 100px;">Insurance</option>
                            <option value="Pixel.jpeg" id="img3" style="padding: 5px;width: 100px;">Pixel</option>
                            <option value="Retail.jpeg" id="img4" style="padding: 5px;width: 100px;">Retail</option>
                        </select>

                        <button onclick="location.href='home';" class="add_btn float-right btn btn-success button_browse">Home</button>
                        <button onclick="location.href='view';" class="add_btn float-right btn btn-success button_browse">View Camera</button>
                        <button id="register" onclick="location.href='registeration';" class="add_btn float-right btn btn-success button_browse">Add Camera</button>
                    </div>

                    <div class="col-md-12 table_div table-responsive" style="padding-left: 0px;">
                        <table class="table table-striped">
                            <thead>
                                <tr class="tr_bgc">
                                    <th style="overflow:hidden; white-space:nowrap;" class="th_list">Camera Name</th>
                                    <th style="overflow:hidden; white-space:nowrap;" class="th_list">RTSP URL</th>
                                    <th style="overflow:hidden; white-space:nowrap;" class="th_list">Email ID List</th>
                                    <th style="overflow:hidden; white-space:nowrap;" class="th_list">SMS List</th>
                                    <th style="overflow:hidden; white-space:nowrap;" class="th_list">Call List</th>

                                    <th style="overflow:hidden; white-space:nowrap;" class="th_list">Hoody</th>
                                    <th style="overflow:hidden; white-space:nowrap;" class="th_list">Masked Face</th>
                                    <th style="overflow:hidden; white-space:nowrap;" class="th_list">Helmet</th>
                                    <th style="overflow:hidden; white-space:nowrap;" class="th_list">Fire</th>
                                    <th style="overflow:hidden; white-space:nowrap;" class="th_list">Intrusion</th>

                                    <th style="overflow:hidden; white-space:nowrap;" class="th_list">Intrusion Start Time</th>
                                    <th style="overflow:hidden; white-space:nowrap;" class="th_list">Intrusion End Time</th>
                                    <th style="overflow:hidden; white-space:nowrap;" class="th_list">Floor</th>

                                    <th style="overflow:hidden; white-space:nowrap;" class="th_list">Sound Alarm</th>
                                    <th style="overflow:hidden; white-space:nowrap;" class="th_list">Actions</th>
                                    <th style="overflow:hidden; white-space:nowrap;" class="th_list"></th>
                                </tr>
                            </thead>
                            <!-- TODO: Replace TEST with actual values -->
                            <tbody>
                                <tr>
                                    <td class="th_list">{{ name }}</td>
                                    <td class="th_list">{{ rtsp }}</td>
                                    <td class="th_list">{{ email }}</td>
                                    <td class="th_list">{{ sms }}</td>
                                    <td class="th_list">{{ call }}</td>
                                    <td class="th_list">TEST</td>
                                    <td class="th_list">TEST</td>
                                    <td class="th_list">TEST</td>
                                    <td class="th_list">TEST</td>
                                    <td class="th_list">TEST</td>
                                    <td class="th_list">{{ start }}</td>
                                    <td class="th_list">{{ end }}</td>
                                    <td class="th_list">{{ floor }}</td>
                                    <td class="th_list">TEST</td>
                                    <td class="th_list">Action</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

<footer class="container-fluid bg-4 text-center footer">
    <p>GoDeep Version 1.0 by
        <a class="link-text" href="https://www.deepsightlabs.com">DeepSight AI Labs</a>
    </p>
    <p>&copy; <script>document.write(new Date().getFullYear())</script> | All Rights Reserved</p>
</footer>

</html>